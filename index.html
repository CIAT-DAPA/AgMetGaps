<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>AgMetGaps</title>
  <link rel="icon" type="image/png" href="https://ciat.cgiar.org/wp-content/uploads/ciat-icon-48.png" />
  <link rel='stylesheet' id='divi-fonts-css' href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&#038;subset=latin,latin-ext'
    type='text/css' media='all' />
  <link rel='stylesheet' id='et-gf-abel-css' href='https://fonts.googleapis.com/css?family=Abel:400&#038;subset=latin' type='text/css'
    media='all' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
    crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="js/lightStyle.js"></script>


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-122951909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-122951909-1');
  </script>

</head>

<body>

  <div class="main-menu">


    <div id="hotspots-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="hotspots-checkbox" />
        <div class="head">
          <span>
            <i class="fas fa-layer-group"> </i> Global hotspots</span>
        </div>
      </label>

      <div id="hotspots-layers">
        <label>
          <input type="radio" name="hotspots" value="Combined_GDD" checked/>
          <div class="box">
            <span>Climate</span>
          </div>
        </label>

        <label>
          <input type="radio" name="hotspots" value="mean_all_crops_filter" />
          <div class="box">
            <span>Crop</span>
          </div>
        </label>

        <label>
          <input type="radio" name="hotspots" value="none" />
          <div class="none">
            <span>CLEAR</span>
          </div>
        </label>
      </div>

    </div>


    <div id="precipitation-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="precipitation-checkbox" />
        <div class="head">
          <span>
            <i class="fas fa-layer-group"> </i> Precipitation</span>
        </div>
      </label>

      <div id="precipitation-layers">
        <label>
          <input type="radio" name="precipitation" value="precipitation" />
          <div class="box">
            <span>C.V.</span>
          </div>
        </label>

        <label>
          <input type="radio" name="precipitation" value="grocprecipitation" />
          <div class="box">
            <span>GROC </span>
          </div>
        </label>

        <label>
          <input type="radio" name="precipitation" value="Precip_WeightedGP_ALL" />
          <div class="box">
            <span>Hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="precipitation" value="none" checked/>
          <div class="none">
            <span>CLEAR</span>
          </div>
        </label>


      </div>
      <div id="temperature-menu" class="sub-menu">

        <label>
          <input type="checkbox" id="temperature-checkbox" />
          <div class="head">
            <span>
              <i class="fas fa-layer-group"> </i> Temperature</span>
          </div>
        </label>
        <div id="temperature-layers">
          <label>
            <input type="radio" name="temperature" value="temperature" />
            <div class="box">
              <span>S.D.</span>
            </div>
          </label>

          <label>
            <input type="radio" name="temperature" value="groctemperature" />
            <div class="box">
              <span>GROC </span>
            </div>
          </label>

          <label>
            <input type="radio" name="temperature" value="Temp_WeightedGT_ALL" />
            <div class="box">
              <span>Hotspots</span>
            </div>
          </label>

          <label>
            <input type="radio" name="temperature" value="none" checked/>
            <div class="none">
              <span>CLEAR</span>
            </div>
          </label>
        </div>
      </div>
    </div>


    <div id="crop-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="crop-checkbox" />
        <div class="crop head">
          <span>
            <i class="fas fa-layer-group"> </i> Crop</span>
        </div>
      </label>
      <div id="crop-layers">
        <label>
          <input type="radio" name="crop" value="maize_cv" />
          <div class="box">
            <span>Maize yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="Maize_filter" />
          <div class="box">
            <span>Maize hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="rice_cv" />
          <div class="box">
            <span>Rice yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="Rice_filter" />
          <div class="box">
            <span>Rice hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="wheat_spring_cv" />
          <div class="box">
            <span>S. Wheat yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="SpringWheat_filter" />
          <div class="box">
            <span>S. Wheat hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="wheat_winter_cv" />
          <div class="box">
            <span>W. Wheat yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="WinterWheat_filter" />
          <div class="box">
            <span>W. Wheat hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="none" checked/>
          <div class="none box">
            <span>CLEAR</span>
          </div>
        </label>
      </div>
    </div>

    <div id="region-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="regions-checkbox" checked />
        <div class="regions head">
          <span>
            <i class="fas fa-globe-africa"></i> Regions</span>
        </div>
      </label>

    </div>
    <div id="about-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="about-checkbox" />
        <div class="regions head">
          <span>
            <i class="fas fa-info-circle"></i> About</span>
        </div>
      </label>

      <div id="about-box">
        <p>
          The AgMetGaps Project aims to scale-up precipitation services for improved agricultural outcomes. Climatically, we define
          a "hotspot" as an area of high climate variability and moderate or high seasonal forecast skill. Agriculturally,
          we define a “hotspot” as an area where; (i) crop yield is highly associated with climate variability; and (ii)
          seasonal forecast skill is moderate or high.
        </p>
        <img src="img/logo/usaid.png">
        <img src="img/logo/ciat.png">
        <img src="img/logo/ccafs.png">
        <img src="img/logo/iri.png">
      </div>
    </div>
  </div>


  <div id="time-slider">
    <div id="custom-handle" class="ui-slider-handle"></div>
  </div>
  </div>


  <div id="map"></div>




  <script>

    var month = ["none", "DJF", "JFM", "FMA", "MAM", "AMJ", "MJJ", "JJA", "JAS", "ASO", "SON", "OND", "NDJ"];

    $("input[type='radio']").click(function () {
      updateMap();
      ga('send', 'event', this.name, "check", $(this).val());
    });

    $("input[type='checkbox']").click(function () {
      var id = this.id;
      var name = id.split("-")[0];
      $("#" + name + "-layers").toggle({ direction: "top" }, 1000);
      ga('send', 'event', name, "deploy", id);
    });

    $("#regions-checkbox").click(function () {
      updateMap();
    });

    $("#about-checkbox").click(function () {
      $("#about-box").slideToggle("fast", "linear");
    });




    var handle = $("#custom-handle");
    $("#time-slider").slider({
      min: 1,
      max: 12,
      value: 1,
      create: function () {
        handle.text(month[$(this).slider("value")]);
      },
      slide: function (event, ui) {
        handle.text(month[ui.value]);
        updateMapBySlider(month[ui.value]);
        ga('send', 'event', "slider", "slide", month[ui.value]);
      }

    });

    var hotspotsOverlay;
    var precipitationOverlay;
    var temperatureOverlay;
    var cropOverlay;
    var regionsOverlay;
    var mapZoom = 3;
    var mapCenter = { lat: 0, lng: 0 };
    var mapTypeSelected = 'lightStyledMapType';
    var mapImageBounds = {
      north: 90,
      south: -90,
      east: 180,
      west: -180
    };
    var map




    function initMap() {

      map = new google.maps.Map(document.getElementById('map'), {
        zoom: mapZoom,
        center: mapCenter,
        streetViewControl: false,
        zoomControl: true,
        zoomControlOptions: {
          position: google.maps.ControlPosition.TOP_LEFT
        },
        fullscreenControl: true,
        fullscreenControlOptions: {
          position: google.maps.ControlPosition.RIGHT_BOTTOM
        },
        mapTypeControlOptions: {
          mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain', 'lightStyledMapType']
        }
      });

      var lightStyledMapType = new google.maps.StyledMapType(lightStyle, { name: 'Light' });

      //Associate the styled map with the MapTypeId and set it to display.
      map.mapTypes.set('lightStyledMapType', lightStyledMapType);
      map.setMapTypeId(mapTypeSelected);

      //Set local storage variables.
      mapCenter = map.getCenter();
      mapZoom = map.getZoom();

      google.maps.event.addListener(map, "center_changed", function () {
        //Set local storage variables.
        mapCenter = map.getCenter();
        mapZoom = map.getZoom();
      });

      google.maps.event.addListener(map, "zoom_changed", function () {
        //Set local storage variables.
        mapCenter = map.getCenter();
        mapZoom = map.getZoom();
      });

      google.maps.event.addListener(map, "maptypeid_changed", function () {
        //Set local storage variables.
        mapTypeSelected = map.getMapTypeId();
      });

      refreshMap("Combined_GDD", "precipitation", "temperature", "Maize_cv", true, month[1]); // initialize all
      hotspotsOverlay.setMap(null);
      precipitationOverlay.setMap(null);
      temperatureOverlay.setMap(null);
      cropOverlay.setMap(null);
      regionsOverlay.setMap(null);
      $("#hotspots-layers").toggle({ direction: "top" }, 1000);
      $("#precipitation-layers").toggle({ direction: "top" }, 1000);
      $("#temperature-layers").toggle({ direction: "top" }, 1000);
      $("#crop-layers").toggle({ direction: "top" }, 1000);
      $("#about-box").slideUp();
      $("#time-slider").toggle();

      refreshMap("Combined_GDD", "none", "none", "none", true, month[1]);
    }

    function updateMap() {

      hotspotsOverlay.setMap(null);
      precipitationOverlay.setMap(null);
      temperatureOverlay.setMap(null);
      cropOverlay.setMap(null);
      regionsOverlay.setMap(null);
      var hotspot = $("#hotspots-menu input[type='radio']:checked").val();
      var precipitationVar = $("#precipitation-menu input[type='radio']:checked").val();
      var temperatureVar = $("#temperature-menu input[type='radio']:checked").val();
      var crop = $("#crop-menu input[type='radio']:checked").val();
      var regions = $("#regions-checkbox").is(":checked");
      var season = month[$("#time-slider").slider("value")];
      refreshMap(hotspot, precipitationVar, temperatureVar, crop, regions, season);
    }

    function updateMapBySlider(season) {
      hotspotsOverlay.setMap(null);
      precipitationOverlay.setMap(null);
      temperatureOverlay.setMap(null);
      cropOverlay.setMap(null);
      regionsOverlay.setMap(null);
      var hotspot = $("#hotspots-menu input[type='radio']:checked").val();
      var precipitationVar = $("#precipitation-menu input[type='radio']:checked").val();
      var temperatureVar = $("#temperature-menu input[type='radio']:checked").val();
      var crop = $("#crop-menu input[type='radio']:checked").val();
      var regions = $("#regions-checkbox").is(":checked");
      refreshMap(hotspot, precipitationVar, temperatureVar, crop, regions, season);
    }

    function refreshMap(hotspot, precipitationVar, temperatureVar, crop, regions, season) {
      var showSlider = false;

      // Create the legend and display on the map
      var legend = document.createElement('div');
      legend.id = 'ts-map-legend';


      //assemble html and place in var
      var content = [];

      if (hotspot != 'none') {

        hotspotsOverlay = new google.maps.GroundOverlay(
          "img/" + 'hotspots' + '/' + hotspot + '.png',
          mapImageBounds);
        hotspotsOverlay.setOpacity(0.7);
        hotspotsOverlay.setMap(map);

        switch (hotspot) {
          case 'Combined_GDD':
            content.push('<h3 class="ts-map-legend-headline">' + ' Climate Hotspots</h3>');
            break;
          case 'mean_all_crops_filter':
            content.push('<h3 class="ts-map-legend-headline">' + ' Crop Hotspots</h3>');
            break;
        }
        content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-hotspots"></div>' + '</p></br>');
        content.push('<p>' + ' min. 0, max. 1' + '</p>');
      }

      if (precipitationVar != 'none') {


        if (precipitationVar == 'Precip_WeightedGP_ALL') {
          precipitationOverlay = new google.maps.GroundOverlay(
            "img/" + 'hotspots' + '/' + precipitationVar + '.png',
            mapImageBounds);
        } else {
          precipitationOverlay = new google.maps.GroundOverlay(
            "img/" + precipitationVar + '/' + season + '.png',
            mapImageBounds)
          showSlider = true;
        }
        precipitationOverlay.setOpacity(0.7);
        precipitationOverlay.setMap(map);

        if (content.length != 0) {
          content.push('<h3></h3>');
        }
        switch (precipitationVar) {
          case 'precipitation':
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Precipitation C.V.</h3>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-precipitation-1"></div>' + ' &lt; 0.33' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-precipitation-2"></div>' + ' 0.33, 0.66' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-precipitation-3"></div>' + ' &gt; 0.66' + '</p>');
            break;
          case 'grocprecipitation':
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Precipitation GROC</h3>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-grocprecipitation-1"></div>' + '&lt; 0.5' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-grocprecipitation-2"></div>' + '0.5, 0.7' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-grocprecipitation-3"></div>' + '&gt; 0.7' + '</p>');
            break;
          case 'Precip_WeightedGP_ALL':
            content.push('<h3 class="ts-map-legend-headline">' + ' Precipitation hotspots</h3>');
            content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-hotspots"></div>' + '</p></br>');
            content.push('<p>' + ' min. 0, max. 1' + '</p>');
            break;
        }
      }


      if (temperatureVar != 'none') {

        if (temperatureVar == 'Temp_WeightedGT_ALL') {
          temperatureOverlay = new google.maps.GroundOverlay(
            "img/" + 'hotspots' + '/' + temperatureVar + '.png',
            mapImageBounds);
        } else {
          temperatureOverlay = new google.maps.GroundOverlay(
            "img/" + temperatureVar + '/' + season + '.png',
            mapImageBounds);
          showSlider = true;
        }
        temperatureOverlay.setOpacity(0.7);
        temperatureOverlay.setMap(map);


        if (content.length != 0) {
          content.push('<h3></h3>');
        }
        switch (temperatureVar) {
          case 'temperature':
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Temperature S.D. (&#8451)</h3>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-temperature-1"></div>' + ' &lt; 0.5' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-temperature-2"></div>' + ' 0.5, 1.0' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-temperature-3"></div>' + ' 1.0, 1.5' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-temperature-4"></div>' + ' &gt; 1.5 ' + '</p>');
            break;
          case 'groctemperature':
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Temperature GROC</h3>'); // uses same color as precipitation
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-grocprecipitation-1"></div>' + '&lt; 0.5' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-grocprecipitation-2"></div>' + '0.5, 0.7' + '</p>');
            content.push('<p><div class="ts-map-legend-color ts-map-legend-color-grocprecipitation-3"></div>' + '&gt; 0.7' + '</p>');
            break;
          case 'Temp_WeightedGT_ALL':
            content.push('<h3 class="ts-map-legend-headline">' + ' Temperature hotspots</h3>');
            content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-hotspots"></div>' + '</p></br>');
            content.push('<p>' + ' min. 0, max. 1' + '</p>');
            break;
        }
      }

      if (crop != 'none') {

        cropOverlay = new google.maps.GroundOverlay(
          "img/" + 'crops' + '/' + crop + '.png',
          mapImageBounds);
        cropOverlay.setOpacity(0.7);
        cropOverlay.setMap(map);

        if (content.length != 0) {
          content.push('<h3></h3>');
        }
        if (crop == 'Maize_filter' || crop == 'Rice_filter' || crop == 'SpringWheat_filter' || crop == 'WinterWheat_filter') {
          content.push('<h3 class="ts-map-legend-headline">Hotspots</h3>');
          content.push('<p><div class="ts-map-legend-color ts-map-legend-color-yield-1"></div>' + '&lt; 0.23' + '</p>');
          content.push('<p><div class="ts-map-legend-color ts-map-legend-color-yield-2"></div>' + '0.23, 0.46' + '</p>');
          content.push('<p><div class="ts-map-legend-color ts-map-legend-color-yield-3"></div>' + '&gt; 0.46' + '</p>');
        } else {
          content.push('<h3 class="ts-map-legend-headline">Yield C.V.</h3>');
          content.push('<p><div class="ts-map-legend-color ts-map-legend-color-yield-1"></div>' + '&lt; 0.33' + '</p>');
          content.push('<p><div class="ts-map-legend-color ts-map-legend-color-yield-2"></div>' + '0.33, 0.66' + '</p>');
          content.push('<p><div class="ts-map-legend-color ts-map-legend-color-yield-3"></div>' + '&gt; 0.66' + '</p>');
        }
      }

      if (regions) {

        regionsOverlay = new google.maps.GroundOverlay(
          "img/" + 'LobelRegions' + '.png',
          mapImageBounds);
        regionsOverlay.setOpacity(0.95);
        regionsOverlay.setMap(map);

        if (content.length != 0) {
          content.push('<h3></h3>');
        }
        content.push('<h3 class="ts-map-legend-headline">Regions</h3>');
        content.push('<p>' + 'Central America' + '</p>');
        content.push('<p>' + 'Western Africa' + '</p>');
        content.push('<p>' + 'Eastern Africa' + '</p>');
        content.push('<p>' + 'Southern Asia' + '</p>');
        content.push('<p>' + 'Easthern Asia' + '</p>');
      }
      legend.innerHTML = content.join('');
      legend.index = 1;
      map.controls[google.maps.ControlPosition.TOP_RIGHT].clear();
      map.controls[google.maps.ControlPosition.TOP_RIGHT].push(legend);

      if (showSlider) {
        $("#time-slider").show();
      } else {
        $("#time-slider").hide();
      }


    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzJRiWK2Iz5Ghwe7Qk-g4FDFxotEOQXtM&callback=initMap"
  />
  <script src="https://maps.googleapis.com/maps/api/staticmap?key=AIzaSyDzJRiWK2Iz5Ghwe7Qk-g4FDFxotEOQXtM&center=21.61520658671325,91.99239959716793&zoom=5&format=png&maptype=roadmap&style=element:geometry%7Ccolor:0x212121&style=element:labels.icon%7Cvisibility:off&style=element:labels.text.fill%7Ccolor:0x757575&style=element:labels.text.stroke%7Ccolor:0x212121&style=feature:administrative%7Celement:geometry%7Ccolor:0x757575&style=feature:administrative.country%7Celement:geometry.stroke%7Cvisibility:on&style=feature:administrative.country%7Celement:labels.text.fill%7Ccolor:0x9e9e9e&style=feature:administrative.land_parcel%7Cvisibility:off&style=feature:administrative.locality%7Celement:labels.text.fill%7Ccolor:0xbdbdbd%7Cvisibility:off&style=feature:landscape%7Cvisibility:on&style=feature:poi%7Celement:labels.text.fill%7Ccolor:0x757575&style=feature:poi.park%7Celement:geometry%7Ccolor:0x181818&style=feature:poi.park%7Celement:geometry.stroke%7Cvisibility:on&style=feature:poi.park%7Celement:labels.text.fill%7Ccolor:0x616161&style=feature:poi.park%7Celement:labels.text.stroke%7Ccolor:0x1b1b1b&style=feature:road%7Celement:geometry.fill%7Ccolor:0x2c2c2c&style=feature:road%7Celement:labels.text.fill%7Ccolor:0x8a8a8a&style=feature:road.arterial%7Cvisibility:off&style=feature:road.arterial%7Celement:geometry%7Ccolor:0x373737&style=feature:road.highway%7Celement:geometry%7Ccolor:0x3c3c3c&style=feature:road.highway%7Celement:labels%7Cvisibility:off&style=feature:road.highway.controlled_access%7Celement:geometry%7Ccolor:0x4e4e4e&style=feature:road.local%7Cvisibility:off&style=feature:road.local%7Celement:labels.text.fill%7Ccolor:0x616161&style=feature:transit%7Celement:labels.text.fill%7Ccolor:0x757575&style=feature:water%7Celement:geometry%7Ccolor:0x000000&style=feature:water%7Celement:geometry.stroke%7Cvisibility:on&style=feature:water%7Celement:labels.text.fill%7Ccolor:0x3d3d3d&size=480x360"
  />



  </script>
</body>

</html>