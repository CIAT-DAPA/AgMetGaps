<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>AgMetGaps</title>
  <link rel="icon" type="image/png" href="https://ciat.cgiar.org/wp-content/uploads/ciat-icon-48.png" />
  <link rel='stylesheet' id='divi-fonts-css' href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&#038;subset=latin,latin-ext'
    type='text/css' media='all' />
  <link rel='stylesheet' id='et-gf-abel-css' href='https://fonts.googleapis.com/css?family=Abel:400&#038;subset=latin' type='text/css'
    media='all' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ"
    crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">
  <script type="text/javascript" src="js/lightStyle.js"></script>


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-122951909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-122951909-1');
  </script>

</head>

<body>

  <div class="main-menu">


    <div id="global-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="global-checkbox" />
        <div class="head">
          <span>
            <i class="fas fa-layer-group"> </i> Global hotspots</span>
        </div>
      </label>

      <div id="global-layers">
        <label>
          <input type="radio" name="global" value="climate" checked />
          <div class="box">
            <span>Climate</span>
          </div>
        </label>

        <label>
          <input type="radio" name="global" value="crops" />
          <div class="box">
            <span>Crop</span>
          </div>
        </label>

      </div>
    </div>


    <div id="precipitation-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="precipitation-checkbox" />
        <div class="head">
          <span>
            <i class="fas fa-layer-group"> </i> Precipitation</span>
        </div>
      </label>

      <div id="precipitation-layers">
        <label>
          <input type="radio" name="precipitation" value="precipitation_cv" />
          <div class="box">
            <span>C.V.</span>
          </div>
        </label>

        <label>
          <input type="radio" name="precipitation" value="precipitation_groc" />
          <div class="box">
            <span>GROC </span>
          </div>
        </label>

        <label>
          <input type="radio" name="precipitation" value="precipitation_hotspots" />
          <div class="box">
            <span>Hotspots</span>
          </div>
        </label>

      </div>
    </div>

    <div id="temperature-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="temperature-checkbox" />
        <div class="head">
          <span>
            <i class="fas fa-layer-group"> </i> Temperature</span>
        </div>
      </label>
      <div id="temperature-layers">
        <label>
          <input type="radio" name="temperature" value="temperature_cv" />
          <div class="box">
            <span>S.D.</span>
          </div>
        </label>

        <label>
          <input type="radio" name="temperature" value="temperature_groc" />
          <div class="box">
            <span>GROC </span>
          </div>
        </label>

        <label>
          <input type="radio" name="temperature" value="temperature_hotspots" />
          <div class="box">
            <span>Hotspots</span>
          </div>
        </label>


      </div>
    </div>



    <div id="crop-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="crop-checkbox" />
        <div class="crop head">
          <span>
            <i class="fas fa-layer-group"> </i> Crop</span>
        </div>
      </label>
      <div id="crop-layers">
        <label>
          <input type="radio" name="crop" value="maize_cv" />
          <div class="box">
            <span>Maize yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="maize_hotspots" />
          <div class="box">
            <span>Maize hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="rice_cv" />
          <div class="box">
            <span>Rice yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="rice_hotspots" />
          <div class="box">
            <span>Rice hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="swheat_cv" />
          <div class="box">
            <span>S. Wheat yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="swheat_hotspots" />
          <div class="box">
            <span>S. Wheat hotspots</span>
          </div>
        </label>

        <label>
          <input type="radio" name="crop" value="wwheat_cv" />
          <div class="box">
            <span>W. Wheat yield</span>
          </div>
        </label>
        <label>
          <input type="radio" name="crop" value="wwheat_hotspots" />
          <div class="box">
            <span>W. Wheat hotspots</span>
          </div>
        </label>

      </div>
    </div>

    <div id="region-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="regions-checkbox" checked />
        <div class="regions head">
          <span>
            <i class="fas fa-globe-africa"></i> Regions</span>
        </div>
      </label>

    </div>
    <div id="about-menu" class="sub-menu">

      <label>
        <input type="checkbox" id="about-checkbox" />
        <div class="regions head">
          <span>
            <i class="fas fa-info-circle"></i> About</span>
        </div>
      </label>

      <div id="about-box">
        <p>
          The AgMetGaps Project aims to scale-up precipitation services for improved agricultural outcomes. Climatically, we define
          a "hotspot" as an area of high climate variability and moderate or high seasonal forecast skill. Agriculturally,
          we define a “hotspot” as an area where; (i) crop yield is highly associated with climate variability; and (ii)
          seasonal forecast skill is moderate or high.
        </p>
        <img src="img/logo/usaid.png">
        <img src="img/logo/ciat.png">
        <img src="img/logo/ccafs.png">
        <img src="img/logo/iri.png">
      </div>
    </div>
  </div>


  <div id="time-slider">
    <div id="custom-handle" class="ui-slider-handle"></div>
  </div>
  </div>


  <div id="map"></div>




  <script>
    var FTP_URL = 'ftp://ftp.ciat.cgiar.org/DAPA/projects/AgMetGaps/web/';
    var IMG_URL = 'img/';

    var month = ["none", "DJF", "JFM", "FMA", "MAM", "AMJ", "MJJ", "JJA", "JAS", "ASO", "SON", "OND", "NDJ"];

    $("input[type='radio']").click(function () {
      var status = $(this).data("status");
      var name = $(this).prop("name");

      // clear the other checked options of the radio group
      $("#" + name + "-menu input[type='radio']").each(function (index) {
        $(this).data("status", "unchecked");;
      });

      // change of status checked/unchecked
      if (status == undefined || status == "unchecked") {
        $(this).prop("checked", true);
        $(this).data("status", "checked");
      } else {
        $(this).prop("checked", false);
        $(this).data("status", "unchecked");
      }

      updateMap();

      gtag('event', $(this).data("status") + "", {
        'event_category': name + "",
        'event_label': $(this).val() + ""
      });
    });

    $("input[type='checkbox']").click(function () {
      var id = this.id;
      var name = id.split("-")[0];
      $("#" + name + "-layers").toggle({ direction: "top" }, 1000);
      gtag('event', "toggle" + "", {
        'event_category': name + "",
        'event_label': id + ""
      });

    });

    $("#regions-checkbox").click(function () {
      updateMap();
    });

    $("#about-checkbox").click(function () {
      $("#about-box").slideToggle("fast", "linear");
    });



    var handle = $("#custom-handle");
    $("#time-slider").slider({
      min: 1,
      max: 12,
      value: 1,
      create: function () {
        handle.text(month[$(this).slider("value")]);
      },
      slide: function (event, ui) {
        handle.text(month[ui.value]);
        updateMapBySlider(month[ui.value]);
        gtag('event', "slide", {
          'event_category': "slider",
          'event_label': month[ui.value] + ""
        });
      }

    });

    var globalOverlay;
    var precipitationOverlay;
    var temperatureOverlay;
    var cropOverlay;
    var regionsOverlay;
    var mapZoom = 3;
    var mapCenter = { lat: 0, lng: 0 };
    var mapTypeSelected = 'lightStyledMapType';
    var mapImageBounds = {
      north: 90,
      south: -90,
      east: 180,
      west: -180
    };
    var map




    function initMap() {

      map = new google.maps.Map(document.getElementById('map'), {
        zoom: mapZoom,
        center: mapCenter,
        streetViewControl: false,
        zoomControl: true,
        zoomControlOptions: {
          position: google.maps.ControlPosition.TOP_LEFT
        },
        fullscreenControl: true,
        fullscreenControlOptions: {
          position: google.maps.ControlPosition.RIGHT_BOTTOM
        },
        mapTypeControlOptions: {
          mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain', 'lightStyledMapType']
        }
      });

      var lightStyledMapType = new google.maps.StyledMapType(lightStyle, { name: 'Light' });

      //Associate the styled map with the MapTypeId and set it to display.
      map.mapTypes.set('lightStyledMapType', lightStyledMapType);
      map.setMapTypeId(mapTypeSelected);

      //Set local storage variables.
      mapCenter = map.getCenter();
      mapZoom = map.getZoom();

      google.maps.event.addListener(map, "center_changed", function () {
        //Set local storage variables.
        mapCenter = map.getCenter();
        mapZoom = map.getZoom();
      });

      google.maps.event.addListener(map, "zoom_changed", function () {
        //Set local storage variables.
        mapCenter = map.getCenter();
        mapZoom = map.getZoom();
      });

      google.maps.event.addListener(map, "maptypeid_changed", function () {
        //Set local storage variables.
        mapTypeSelected = map.getMapTypeId();
      });

      refreshMap("climate", "precipitation_hotspots", "temperature_hotspots", "maize_cv", true, month[1]); // initialize all
      globalOverlay.setMap(null);
      precipitationOverlay.setMap(null);
      temperatureOverlay.setMap(null);
      cropOverlay.setMap(null);
      regionsOverlay.setMap(null);
      $("#global-layers").toggle({ direction: "top" }, 1000);
      $("#precipitation-layers").toggle({ direction: "top" }, 1000);
      $("#temperature-layers").toggle({ direction: "top" }, 1000);
      $("#crop-layers").toggle({ direction: "top" }, 1000);
      $("#about-box").slideUp();
      $("#time-slider").toggle();

      refreshMap("climate", undefined, undefined, undefined, true, month[1]);
      $("#hotspots-menu input[type='radio']:checked").data("status", "checked");
    }

    function updateMap() {

      globalOverlay.setMap(null);
      precipitationOverlay.setMap(null);
      temperatureOverlay.setMap(null);
      cropOverlay.setMap(null);
      regionsOverlay.setMap(null);
      var global = $("#global-menu input[type='radio']:checked").val();
      var precipitationVar = $("#precipitation-menu input[type='radio']:checked").val();
      var temperatureVar = $("#temperature-menu input[type='radio']:checked").val();
      var crop = $("#crop-menu input[type='radio']:checked").val();
      var regions = $("#regions-checkbox").is(":checked");
      var season = month[$("#time-slider").slider("value")];
      refreshMap(global, precipitationVar, temperatureVar, crop, regions, season);
    }

    function updateMapBySlider(season) {
      globalOverlay.setMap(null);
      precipitationOverlay.setMap(null);
      temperatureOverlay.setMap(null);
      cropOverlay.setMap(null);
      regionsOverlay.setMap(null);
      var hotspot = $("#hotspots-menu input[type='radio']:checked").val();
      var precipitationVar = $("#precipitation-menu input[type='radio']:checked").val();
      var temperatureVar = $("#temperature-menu input[type='radio']:checked").val();
      var crop = $("#crop-menu input[type='radio']:checked").val();
      var regions = $("#regions-checkbox").is(":checked");
      refreshMap(hotspot, precipitationVar, temperatureVar, crop, regions, season);
    }

    function refreshMap(global, precipitationVar, temperatureVar, crop, regions, season) {
      var showSlider = false;
      var opacity = 0.7;

      // Create the legend and display on the map
      var legend = document.createElement('div');
      legend.id = 'ts-map-legend';


      //assemble html and place in var
      var content = [];

      if (global != undefined) {
        var layerRelativePath = 'global/' + global
        globalOverlay = new google.maps.GroundOverlay(
          IMG_URL + layerRelativePath + '.png',
          mapImageBounds);
        globalOverlay.setOpacity(opacity);
        globalOverlay.setMap(map);

        switch (global) {
          case 'climate':
            content.push('<h3 class="ts-map-legend-headline">' + ' Climate Hotspots</h3>');
            break;
          case 'crops':
            content.push('<h3 class="ts-map-legend-headline">' + ' Crop Hotspots</h3>');
            break;
        }
        content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-hotspots"></div>' + '</p></br>');
        content.push('<p>' + ' min. 0, max. 1' + '</p><p> <i class="fas fa-download"> </i> <a href="' + FTP_URL + layerRelativePath + '.zip' + '">download</a> </p>');
      }

      if (precipitationVar != undefined) {
        var layerRelativePath = "";

        if (content.length != 0) {
          content.push('<h3></h3>');
        }

        switch (precipitationVar) {
          case 'precipitation_cv':
            layerRelativePath = 'precipitation/CV/' + season + "_" + precipitationVar;
            precipitationOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds);
            showSlider = true;
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Precipitation C.V.</h3>');
            break;
          case 'precipitation_groc':
            layerRelativePath = 'precipitation/GROC/' + season + "_" + precipitationVar;
            precipitationOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds);
            showSlider = true;
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Precipitation GROC</h3>');
            break;
          case 'precipitation_hotspots':
            layerRelativePath = 'precipitation/hotspots/' + precipitationVar;
            precipitationOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds);
            content.push('<h3 class="ts-map-legend-headline">' + ' Precipitation hotspots</h3>');
            break;
        }
        precipitationOverlay.setOpacity(opacity);
        precipitationOverlay.setMap(map);


        content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-precipitation"></div>' + '</p></br>');
        content.push('<p>' + ' min. 0, max. 1' + '</p><p> <i class="fas fa-download"> </i> <a href="' + FTP_URL + layerRelativePath + '.zip' + '">download</a> </p>');
      }


      if (temperatureVar != undefined) {

        if (content.length != 0) {
          content.push('<h3></h3>');
        }

        switch (temperatureVar) {
          case 'precipitation_cv':
            layerRelativePath = 'temperature/SD/' + season + "_" + temperatureVar;
            temperatureOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds);
            showSlider = true;
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Temperature S.D.</h3>');
            break;
          case 'temperature_groc':
            layerRelativePath = 'temperature/GROC/' + season + "_" + temperatureVar;
            temperatureOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds);
            showSlider = true;
            content.push('<h3 class="ts-map-legend-headline">' + season + ' Temperature GROC</h3>');
            break;
          case 'temperature_hotspots':
            layerRelativePath = 'temperature/hotspots/' + temperatureVar;
            temperatureOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds);
            content.push('<h3 class="ts-map-legend-headline">' + ' Temperature hotspots</h3>');
            break;
        }
        temperatureOverlay.setOpacity(opacity);
        temperatureOverlay.setMap(map);


        content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-temperature"></div>' + '</p></br>');
        content.push('<p>' + ' min. 0, max. 1' + '</p><p> <i class="fas fa-download"> </i> <a href="' + FTP_URL + layerRelativePath + '.zip' + '">download</a> </p>');
      }

      if (crop != undefined) {

        var name = crop.split("_")[1];
        var layerRelativePath = "";

        if (content.length != 0) {
          content.push('<h3></h3>');
        }
        switch (name) {
          case 'cv':
            layerRelativePath = 'crops/CV/' + crop;
            cropOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds)
            showSlider = true;
            content.push('<h3 class="ts-map-legend-headline">Yield C.V.</h3>');
            break;
          case 'hotspots':
            layerRelativePath = 'crops/hotspots/' + crop;
            cropOverlay = new google.maps.GroundOverlay(IMG_URL + layerRelativePath + '.png', mapImageBounds)
            showSlider = true;
            content.push('<h3 class="ts-map-legend-headline">Hotspots</h3>');
            break;

        }

        cropOverlay.setOpacity(opacity);
        cropOverlay.setMap(map);
        content.push('<p><div class="ts-map-legend-gradient ts-map-legend-gradient-crop"></div>' + '</p></br>');
        content.push('<p>' + ' min. 0, max. 1' + '</p><p> <i class="fas fa-download"> </i> <a href="' + FTP_URL + layerRelativePath + '.zip' + '">download</a> </p>');
      }

      if (regions) {

        regionsOverlay = new google.maps.GroundOverlay(
          IMG_URL + 'LobelRegions' + '.png',
          mapImageBounds);
        regionsOverlay.setOpacity(0.95);
        regionsOverlay.setMap(map);

        if (content.length != 0) {
          content.push('<h3></h3>');
        }
        content.push('<h3 class="ts-map-legend-headline">Regions</h3>');
        content.push('<p>' + 'Central America' + '</p>');
        content.push('<p>' + 'Western Africa' + '</p>');
        content.push('<p>' + 'Eastern Africa' + '</p>');
        content.push('<p>' + 'Southern Asia' + '</p>');
        content.push('<p>' + 'Easthern Asia' + '</p>');
      }
      legend.innerHTML = content.join('');
      legend.index = 1;
      map.controls[google.maps.ControlPosition.TOP_RIGHT].clear();
      map.controls[google.maps.ControlPosition.TOP_RIGHT].push(legend);

      if (showSlider) {
        $("#time-slider").show();
      } else {
        $("#time-slider").hide();
      }


    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzJRiWK2Iz5Ghwe7Qk-g4FDFxotEOQXtM&callback=initMap"
  />




  </script>
</body>

</html>